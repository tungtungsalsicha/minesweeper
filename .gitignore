import java.util.Random;
import javax.swing.*;
import java.awt.*;

public class Tabuleiro {
    private int largura;
    private int altura;
    private int numMinas;
    private Celula[][] tabuleiro;

    public Tabuleiro(int largura, int altura, int numMinas) {
        this.largura = largura;
        this.altura = altura;
        this.numMinas = numMinas;
        tabuleiro = new Celula[altura][largura];
        inicializarTabuleiro();
    }

    private void inicializarTabuleiro() {
        for (int i = 0; i < altura; i++) {
            for (int j = 0; j < largura; j++) {
                tabuleiro[i][j] = new Celula(i, j);
            }
        }

        Random rand = new Random();
        int minasColocadas = 0;

        while (minasColocadas < numMinas) {
            int i = rand.nextInt(altura);
            int j = rand.nextInt(largura);
            if (!tabuleiro[i][j].temMina()) {
                tabuleiro[i][j].colocarMina();
                minasColocadas++;
            }
        }

        for (int i = 0; i < altura; i++) {
            for (int j = 0; j < largura; j++) {
                if (!tabuleiro[i][j].temMina()) {
                    tabuleiro[i][j].setNumeroMinasAdjacentes(
                            contarMinasAdjacentes(i, j)
                    );
                }
            }
        }
    }

    private int contarMinasAdjacentes(int linha, int coluna) {
        int minas = 0;

        for (int i = -1; i <= 1; i++) {
            for (int j = -1; j <= 1; j++) {
                int l = linha + i;
                int c = coluna + j;

                if (l >= 0 && l < altura && c >= 0 && c < largura) {
                    if (tabuleiro[l][c].temMina()) {
                        minas++;
                    }
                }
            }
        }
        return minas;
    }

    public Celula getCelula(int linha, int coluna) {
        return tabuleiro[linha][coluna];
    }

    public int getAltura() {
        return altura;
    }

    public int getLargura() {
        return largura;
    }

    public boolean verificarFimDeJogo() {
        for (int i = 0; i < altura; i++) {
            for (int j = 0; j < largura; j++) {
                if (!tabuleiro[i][j].estaAberta() &&
                        !tabuleiro[i][j].temMina()) {
                    return false;
                }
            }
        }
        return true;
    }
}
class Celula {
    private boolean temMina;
    private int numeroMinasAdjacentes;
    private boolean aberta;

    public Celula(int linha, int coluna) {
        temMina = false;
        numeroMinasAdjacentes = 0;
        aberta = false;
    }

    public boolean temMina() {
        return temMina;
    }

    public void colocarMina() {
        temMina = true;
    }

    public int getNumeroMinasAdjacentes() {
        return numeroMinasAdjacentes;
    }

    public void setNumeroMinasAdjacentes(int n) {
        numeroMinasAdjacentes = n;
    }

    public boolean estaAberta() {
        return aberta;
    }

    public void abrir() {
        aberta = true;
    }
}


class BotaoCelula extends JButton {
    private int linha;
    private int coluna;
    private Tabuleiro tabuleiro;
    private BotaoCelula[][] botoes;

    public BotaoCelula(int linha, int coluna, Tabuleiro tabuleiro, BotaoCelula[][] botoes) {
        this.linha = linha;
        this.coluna = coluna;
        this.tabuleiro = tabuleiro;
        this.botoes = botoes;

        setPreferredSize(new Dimension(40, 40));
        addActionListener(e -> abrirCelula());
    }

    public void abrirCelula() {
        Celula celula = tabuleiro.getCelula(linha, coluna);

        if (celula.estaAberta()) return;

        celula.abrir();

        if (celula.temMina()) {
            setText("ðŸ’£");
            setBackground(Color.RED);
            JOptionPane.showMessageDialog(this, "Game Over!");
            return;
        }

        setBackground(Color.LIGHT_GRAY);

        int minas = celula.getNumeroMinasAdjacentes();
        if (minas > 0) {
            setText(String.valueOf(minas));
        } else {
            abrirCelasAdjacentes();
        }

        if (tabuleiro.verificarFimDeJogo()) {
            JOptionPane.showMessageDialog(this, "VocÃª venceu!");
        }
    }

    private void abrirCelasAdjacentes() {
        for (int i = -1; i <= 1; i++) {
            for (int j = -1; j <= 1; j++) {
                int l = linha + i;
                int c = coluna + j;

                if (l >= 0 && l < tabuleiro.getAltura() &&
                        c >= 0 && c < tabuleiro.getLargura()) {
                    botoes[l][c].abrirCelula();
                }
            }
        }
    }
}
